---
title:DASH流和播放列表
description:本主題說明如何為 DASH 輸出配置作業。
parent: Encoding Guides
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

  <section class="bcls-section">
    <h2 id="Introduction">簡介</h2>

    <aside class="bcls-aside bcls-aside--information">請注意，Dash 與使用 Zencoder 的實時流不兼容。</aside>
    <p>由於DASH不是特定的視頻格式，編解碼器或與數據無關的打包格式（例如Zip），因此我們引入了一個新選項，名為<a href="/encoding-settings/assets/encoding-settings-clips.html#streaming-delivery-format"><code translate="No">streaming_delivery_format</code></a>指定應根據特定標準對媒體文件進行結構化/格式化。選擇“破折號"作為<code translate="No">streaming_delivery_format</code>將修改一些默認選項以與DASH兼容，並將輸出媒體文件放入符合DASH要求的目錄結構中。DASH媒體輸出還必須具有<a href="/encoding-settings/general/encoding-settings-general-output-settings.html#type"><code translate="No">type</code></a>設置為“分段"，以確保媒體已準備好進行DASH流傳輸。</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "streaming_delivery_format": "dash",
        "video_bitrate": 700,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/sbr/rendition.mpd"
    }
    ]
}</code></pre>

    <p>輸出的詳細信息<code translate="No">streaming_delivery_format</code>設置為“破折號"：</p>

    <ul>
      <li><a href="/encoding-settings/general-audio-video/encoding-settings-frame-rate.html#fixed-keyframe-interval"><code translate="No">fixed_keyframe_interval</code></a>將設置為true。</li>
      <li><a href="/encoding-settings/assets/encoding-settings-clips.html#segment-seconds"><code translate="No">segment_seconds</code></a>將默認為2。</li>
      <li>默認格式為<code translate="No">m4f</code>（與<code translate="No">mpd</code>清單文件）</li>
    </ul>
    <p>分段DASH輸出的文件結構：</p>

    <ul>
      <li>這<code translate="No">mpd</code>清單文件將位於輸出的根目錄級別。</li>
      <li>音頻和視頻媒體將各自具有自己的子目錄-“<code translate="No">audio/und</code>“和 "<code translate="No">video/1</code>“分別。</li>
      <li>在這些目錄中的每個目錄中都會有一個“<code translate="No">init.mp4</code>"和初始化數據。</li>
      <li>媒體數據將存儲在名為“<code translate="No">seg-N.m4f</code>"（其中N從零開始，並在每個段中增加）。</li>
    </ul>
    <p>DASH輸出與<a href="/encoding-settings/assets/encoding-settings-clips.html#streaming-delivery-profile"><code translate="No">streaming_delivery_profile</code></a>設置為“on_demand"將使用碎片化的媒體文件而不是分段：</p>

    <ul>
      <li>這<code translate="No">mpd</code>清單文件將位於輸出的根目錄級別。</li>
      <li>音頻和視頻媒體都將是與清單相同目錄中的單個文件。</li>
      <li>媒體文件的名稱將與清單相似，但帶有“<code translate="No">-audio</code>“或者 "<code translate="No">-video</code>"（根據需要添加了後綴）。</li>
    </ul>
    <p>支持的DASH配置：</p>

    <ul>
      <li>支持的格式：<code translate="No">m4f</code>和<code translate="No">webm</code></li>
      <li>支持的視頻編解碼器：<code translate="No">h264</code>，<code translate="No">hevc</code>，<code translate="No">vp8</code>， 和<code translate="No">vp9</code></li>
      <li>支持的音頻編解碼器：<code translate="No">aac</code>，<code translate="No">ac3</code>，<code translate="No">eac3</code>， 和<code translate="No">vorbis</code></li>
      <li>“"中的輸出<code translate="No">webm</code>"格式目前僅支持“on_demand"<code translate="No">streaming_delivery_profile</code></li>
      <li>“"中的輸出<code translate="No">webm</code>“格式目前不支持DRM</li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="Multiple_Bitrates">多種比特率</h2>

    <p>Zencoder生成的DASH輸出將具有自己播放所需的結構，但是要真正受益於此類流送選項，您應該以不同的比特率（再現）生成多個版本以及列出再現的“播放列表"類型輸出以便播放器可以根據當前網絡狀況根據需要切換比特率。播放列表輸出是一個從屬輸出-也就是說，它將通過其標籤引用其他輸出，並將使用這些輸出中的數據來生成播放列表的最終格式。請注意，您必須謹慎設置播放列表輸出中的流路徑，以使它們成為移交文件位置的相對路徑。</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "label": "dash-1200",
        "streaming_delivery_format": "dash",
        "video_bitrate": 1200,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/mbr/1200k/rendition.mpd"
    },
    {
        "label": "dash-700",
        "streaming_delivery_format": "dash",
        "video_bitrate": 700,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/mbr/700k/rendition.mpd"
    },
    {
        "label": "dash-400",
        "streaming_delivery_format": "dash",
        "video_bitrate": 400,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/mbr/400k/rendition.mpd"
    },
    {
        "streaming_delivery_format": "dash",
        "type": "playlist",
        "url": "s3://mybucket/dash-examples/mbr/manifest.mpd",
        "streams": [
        { "source": "dash-1200", "path": "1200k" },
        { "source": "dash-700",  "path": "700k" },
        { "source": "dash-400",  "path": "400k" }
        ]
    }
    ]
}</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Encryption">加密</h2>

    <p>Zencoder還支持生成CENC加密的DASH輸出，並帶有與Marlin或Playready許可證服務器集成所需的標頭。對於每個輸出，只需指定drm選項的哈希即可，包括<a href="/encoding-settings/content-protection/encoding-settings-drm.html#method"><code translate="No">method</code></a>，<a href="/encoding-settings/content-protection/encoding-settings-drm.html#key-id"><code translate="No">key_id</code></a>， 和<a href="/encoding-settings/content-protection/encoding-settings-drm.html#content-key"><code translate="No">content_key</code></a>。這<code translate="No">key_id</code>和<code translate="No">content_key</code>應該從您的DRM供應商處檢索，或預先生成並發送給您的DRM供應商。有了這些鍵後，單個表示形式的Zencoder API結構為：</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "streaming_delivery_format": "dash",
        "video_bitrate": 700,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/sbr/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    }
    ]
}</code></pre>

    <p>內容將使用<code translate="No">content_key</code>和<code translate="No">.mpd</code>清單文件將包含<code translate="No">key_id</code>在其標題中。但是，為確保此輸出可播放，它還需要標頭，指定如何檢索<code translate="No">content_key</code>。在多比特率DASH編碼上，這些標頭僅需要添加到播放列表輸出中，但也可以添加到每個格式副本中，因此格式副本可以單獨播放。這可以通過添加一個或多個DRM模式來完成：</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "streaming_delivery_format": "dash",
        "video_bitrate": 700,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/sbr/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0",
            "schemas": [
            { "type": "marlin" },
            { "type": "playready", "license_acquisition_url": "https://playready.example.com/license_server/" }
            ]
        }
    }
    ]
}</code></pre>

    <p>然後，我們可以將其放在一起以創建一個多比特率，DRM加密的DASH作業：</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "label": "dash-1200",
        "streaming_delivery_format": "dash",
        "video_bitrate": 1200,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/mbr/1200k/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    },
    {
        "label": "dash-700",
        "streaming_delivery_format": "dash",
        "video_bitrate": 700,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/mbr/700k/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    },
    {
        "label": "dash-400",
        "streaming_delivery_format": "dash",
        "video_bitrate": 400,
        "type": "segmented",
        "url": "s3://mybucket/dash-examples/mbr/400k/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    },
    {
        "streaming_delivery_format": "dash",
        "type": "playlist",
        "url": "s3://mybucket/dash-examples/mbr/manifest.mpd",
        "streams": [
        { "source": "dash-1200", "path": "1200k" },
        { "source": "dash-700",  "path": "700k" },
        { "source": "dash-400",  "path": "400k" }
        ],
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0",
            "schemas": [
            { "type": "marlin" },
            { "type": "playready", "license_acquisition_url": "https://playready.example.com/license_server/" }
            ]
        }
    }
    ]
}
</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Transmuxing">轉換</h2>

    <p>當然，生成多種格式的視頻可能會變得既昂貴又浪費。因此，Zencoder支持通過使用<a href="/encoding-settings/general-audio-video/encoding-settings-transmuxing.html#copy-video"><code translate="No">copy_video</code></a>和<a href="/encoding-settings/general-audio-video/encoding-settings-transmuxing.html#copy-audio"><code translate="No">copy_audio</code></a>選項。對視頻進行多路復用而不是對其進行編碼的輸出，按常規時長的1/4收費。因此，如果您打算製作同一視頻的多種格式（例如，MP4，HLS和DASH），則可以先對每個比特率的MP4版本進行編碼，然後對這些輸出進行多路復用以創建HLS和DASH版本。（請注意，由於視頻不再是單個流，因此我們不支持從分段格式進行多路復用。）</p>

    <p>為確保MP4是根據後續分段流格式的約束準備的，還請使用<a href="/encoding-settings/assets/encoding-settings-clips.html#prepare-for-segmenting"><code translate="No">prepare_for_segmenting</code></a> MP4輸出上的選項。在對MP4的視頻流進行編碼時，這將控制關鍵幀和字幕的默認值，以確保以後與將其轉換為分段格式兼容。</p>

    <p>將MP4用作多路復用輸出的源，其工作方式與播放列表輸出類似。您可以指定與另一個輸出的標籤匹配的源選項，但這一次，它是輸出的主級別選項的一部分，而不是流哈希中。</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "label": "mp4-700k",
        "prepare_for_segmenting": ["hls", "dash"],
        "video_bitrate": 700,
        "url": "s3://mybucket/transmux-examples/sbr/video.mp4"
    },
    {
        "source": "mp4-700k",
        "copy_video": true,
        "copy_audio": true,
        "type": "segmented",
        "url": "s3://mybucket/transmux-examples/sbr/hls/video.m3u8"
    },
    {
        "source": "mp4-700k",
        "copy_video": true,
        "copy_audio": true,
        "streaming_delivery_format": "dash",
        "type": "segmented",
        "url": "s3://mybucket/transmux-examples/sbr/dash/video.mpd"
    }
    ]
}</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Optimizing_for_delivery">優化交付</h2>

    <p>由於DASH用於流式傳輸，因此我們建議控制每個再現中的比特率峰值，以避免播放器重新緩衝或不必要地切換到較低比特率編碼。根據解碼器/播放器可以處理的內容來控制編碼流的可變性的選項是</p>

    <ul>
      <li><a href="/encoding-settings/general-audio-video/encoding-settings-rate-control.html#decoder-bitrate-cap"><code translate="No">decoder_bitrate_cap</code></a></li>
      <li><a href="/encoding-settings/general-audio-video/encoding-settings-rate-control.html#decoder-buffer-size"><code translate="No">decoder_buffer_size</code></a></li>
    </ul>
    <aside class="bcls-aside bcls-aside--information">筆記：<a href="/encoding-settings/general-audio-video/encoding-settings-rate-control.html#max-video-bitrate"><code translate="No">max_video_bitrate</code></a>用於控制整個流的最大平均比特率，不適用於流媒體內容。</aside>
    <p>我們的一般建議是<code translate="No">decoder_bitrate_cap</code>達到視頻流可用的最大比特率。請記住，您需要考慮音頻以及文件格式的一些開銷。這<code translate="No">decoder_buffer_size</code>從技術上講，它應該與解碼設備上的可用視頻緩衝存儲器匹配，但通常更好地用於控制可以預緩衝多少內容。它的作用是<code translate="No">decoder_bitrate_cap</code>，例如<code translate="No">decoder_bitrate_cap</code>是500（每秒千比特），並且<code translate="No">decoder_buffer_size</code>是1000（千位），則緩衝區可以存儲2秒的視頻。我們還建議設置<a href="/encoding-settings/general-audio-video/encoding-settings-rate-control.html#video-bitrate"><code translate="No">video_bitrate</code></a>比<code translate="No">decoder_bitrate_cap</code>，編碼器可以使用更多的數據來編碼複雜的場景，而在簡單的場景中使用更少的數據。體面的出發點是假設文件格式的開銷最多為10％，<code translate="No">video_bitrate</code>比<code translate="No">decoder_bitrate_cap</code>，並允許緩衝大約1.5秒的視頻。</p>

    <p>假設有1000 Kbps的連接可供客戶使用：</p>

    <ul>
      <li>減去10％的格式開銷後，可獲得1000 * 0.90 = 900 Kbps。</li>
      <li>900-128 = 772 Kbps視頻<code translate="No">decoder_bitrate_cap</code>減去128 Kbps的音頻後。</li>
      <li>772 * 1.5 = 1158 Kb <code translate="No">decoder_buffer_size</code>（價值1.5秒的視頻）。</li>
      <li>772 * 0.90 = 695 Kbps目標視頻比特率（比標準視頻比特率低10％<code translate="No">decoder_bitrate_cap</code>）。</li>
    </ul>
    <p>因此，對於更正確的流編碼示例：</p>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "label": "mp4-1000k",
        "prepare_for_segmenting": ["hls", "dash"],
        "audio_bitrate": 128,
        "decoder_bitrate_cap": 772,
        "decoder_buffer_size": 1158,
        "video_bitrate": 695,
        "url": "s3://mybucket/transmux-examples/sbr/video.mp4"
    },
    {
        "source": "mp4-1000k",
        "copy_video": true,
        "copy_audio": true,
        "type": "segmented",
        "url": "s3://mybucket/transmux-examples/sbr/hls/video.m3u8"
    },
    {
        "source": "mp4-1000k",
        "copy_video": true,
        "copy_audio": true,
        "streaming_delivery_format": "dash",
        "type": "segmented",
        "url": "s3://mybucket/transmux-examples/sbr/dash/video.mpd"
    }
    ]
}</code></pre>

    <aside class="bcls-aside bcls-aside--information">筆記：以上是<strong>不是</strong>足以保證HLS編碼將通過Apple的驗證。儘管它可以在1000 Kbps的連接速度下無縫傳輸，但Apple會測量每個段的比特率（包括可能持續時間較短的最終段），而無需考慮緩衝方面。為確保 HLS 編碼通過 Apple 的驗證，請參閱我們的 HLS 指南。</aside>
  </section>
  <section class="bcls-section">
    <h2 id="Putting_it_all_together">全部放在一起</h2>

    <pre class="line-numbers">
<code class="language-json" translate="No">{
    "input": "http://s3.amazonaws.com/zencodertesting/test.mov",
    "outputs": [
    {
        "label": "mp4-1500k",
        "prepare_for_segmenting": ["hls", "dash"],
        "audio_bitrate": 128,
        "decoder_bitrate_cap": 1222,
        "decoder_buffer_size": 1833,
        "video_bitrate": 1100,
        "size": "1280x720",
        "url": "s3://mybucket/full-examples/mp4/1500.mp4"
    },
    {
        "label": "mp4-1000k",
        "prepare_for_segmenting": ["hls", "dash"],
        "audio_bitrate": 128,
        "decoder_bitrate_cap": 772,
        "decoder_buffer_size": 1158,
        "video_bitrate": 695,
        "size": "960x540",
        "url": "s3://mybucket/full-examples/mp4/1000.mp4"
    },
    {
        "label": "mp4-500k",
        "prepare_for_segmenting": ["hls", "dash"],
        "audio_bitrate": 128,
        "decoder_bitrate_cap": 322,
        "decoder_buffer_size": 483,
        "video_bitrate": 290,
        "size": "640x360",
        "url": "s3://mybucket/full-examples/mp4/500.mp4"
    },
    {
        "label": "hls-1500k",
        "source": "mp4-1500k",
        "copy_video": true,
        "copy_audio": true,
        "type": "segmented",
        "url": "s3://mybucket/full-examples/hls/1500.m3u8"
    },
    {
        "label": "hls-1000k",
        "source": "mp4-1000k",
        "copy_video": true,
        "copy_audio": true,
        "type": "segmented",
        "url": "s3://mybucket/full-examples/hls/1000.m3u8"
    },
    {
        "label": "hls-500k",
        "source": "mp4-500k",
        "copy_video": true,
        "copy_audio": true,
        "type": "segmented",
        "url": "s3://mybucket/full-examples/hls/500.m3u8"
    },
    {
        "type": "playlist",
        "url": "s3://mybucket/full-examples/hls/multi_bitrate_playlist.m3u8",
        "streams": [
        { "path": "1000.m3u8", "source": "hls-1000k" },
        { "path": "1500.m3u8", "source": "hls-1500k" },
        { "path": "500.m3u8", "source": "hls-500k" }
        ]
    },
    {
        "label": "dash-1500k",
        "source": "mp4-1500k",
        "copy_video": true,
        "copy_audio": true,
        "streaming_delivery_format": "dash",
        "type": "segmented",
        "url": "s3://mybucket/full-examples/dash/1500k/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    },
    {
        "label": "dash-1000k",
        "source": "mp4-1000k",
        "copy_video": true,
        "copy_audio": true,
        "streaming_delivery_format": "dash",
        "type": "segmented",
        "url": "s3://mybucket/full-examples/dash/1000k/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    },
    {
        "label": "dash-500k",
        "source": "mp4-500k",
        "copy_video": true,
        "copy_audio": true,
        "streaming_delivery_format": "dash",
        "type": "segmented",
        "url": "s3://mybucket/full-examples/dash/500k/rendition.mpd",
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0"
        }
    },
    {
        "streaming_delivery_format": "dash",
        "type": "playlist",
        "url": "s3://mybucket/full-examples/dash/manifest.mpd",
        "streams": [
            { "source": "dash-1500k", "path": "1500k" },
            { "source": "dash-1000k", "path": "1000k" },
            { "source": "dash-500k",  "path": "500k" }
        ],
        "drm": {
            "method": "cenc",
            "key_id": "d57d416ccd454d5a08d05bff0742ee76",
            "content_key": "f15cae8f4e48a023056e1960ff2228b0",
            "schemas": [
                { "type": "marlin" },
                { "type": "playready", "license_acquisition_url": "https://playready.example.com/license_server/" }
            ]
        }
    }
    ]
}</code></pre>
  </section>
</article>